<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>gpt_calendar.py 코드 설명</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f9f9f9; padding: 2rem; line-height: 1.6; }
    h1, h2 { color: #2c3e50; }
    code, pre { background: #eee; padding: 3px 6px; border-radius: 4px; }
    .block { background: #fff; padding: 1rem; border-left: 5px solid #00a1d6; margin-bottom: 2rem; border-radius: 6px; }
  </style>
</head>
<body>

  <h1>🤖 <code>gpt_calendar.py</code> 파일 설명</h1>
  <p>이 파일은 <strong>GPT와 Google Calendar를 연동</strong>하여 사용자의 자연어 쿼리에 따라 일정을 분석하고, 대답을 만들어주는 똑똑한 AI 로직입니다.</p>

  <div class="block">
    <h2>📌 주요 기능 요약</h2>
    <ul>
      <li>OpenAI GPT-3.5를 통해 자연어에서 날짜 범위 추출</li>
      <li>Google Calendar API로 해당 일정 조회</li>
      <li>GPT에게 결과 요약 및 대화형 답변 생성 요청</li>
      <li>전체 예외 처리 및 에러 메시지 출력 강화</li>
    </ul>
  </div>

  <div class="block">
    <h2>🧠 <code>init_openai_client()</code></h2>
    <p>환경 변수에서 API 키를 불러와 <code>OpenAI</code> 클라이언트를 초기화합니다.</p>
  </div>

  <div class="block">
    <h2>📅 <code>extract_date_range(query: str)</code></h2>
    <p>GPT에게 <code>오늘</code>, <code>내일</code>, <code>다음 주</code> 같은 자연어 표현을 해석시켜 <strong>ISO 8601</strong> 포맷의 날짜 범위를 뽑아냅니다.</p>
    <pre><code>{ "start_time": "2025-05-22T00:00:00", "end_time": "2025-05-24T23:59:59" }</code></pre>
  </div>

  <div class="block">
    <h2>🔁 <code>process_calendar_query(query, user_id, platform='google')</code></h2>
    <p>자연어 쿼리를 처리하는 핵심 함수입니다.</p>
    <ol>
      <li><strong>1단계:</strong> <code>extract_date_range()</code>로 날짜 범위 추출</li>
      <li><strong>2단계:</strong> <code>get_calendar_service()</code> + <code>get_events()</code>로 해당 기간 일정 불러오기</li>
      <li><strong>3단계:</strong> GPT에게 일정 내용을 요약 요청</li>
    </ol>
    <p>응답 예시는 아래와 같은 JSON 형태입니다:</p>
    <pre><code>{
  "status": "success",
  "user_id": "test@example.com",
  "query_info": {
    "original_query": "이번 주 일정 보여줘",
    "start_time": "2025-05-20T00:00:00",
    "end_time": "2025-05-26T23:59:59"
  },
  "events": [
    { "summary": "회의", "start": "2025-05-22 14:00", ... }
  ],
  "response": "이번 주 목요일 오후 2시에 회의가 있어요!"
}</code></pre>
  </div>

  <div class="block">
    <h2>🚨 에러 핸들링</h2>
    <p>에러 상황별로 구체적인 로그를 출력하며, 다음과 같이 단계별 처리됩니다:</p>
    <ul>
      <li><code>[API ERROR]</code> 인증 실패, datetime 오류 등</li>
      <li><code>[GPT ERROR]</code> GPT 호출 실패, 응답 파싱 오류 등</li>
    </ul>
  </div>

  <div class="block">
    <h2>🔍 <code>__main__</code> 실행</h2>
    <p>터미널에서 직접 실행 시, 쿼리를 입력받아 결과를 출력합니다.</p>
    <pre><code>python gpt_calendar.py</code></pre>
  </div>

</body>
</html>
