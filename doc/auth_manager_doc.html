<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>auth_manager.py ì„¤ëª…ì„œ</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f9f9f9; padding: 2rem; line-height: 1.6; }
    h1, h2 { color: #2c3e50; }
    code, pre { background: #eee; padding: 3px 6px; border-radius: 4px; }
    .block { background: #fff; padding: 1rem; border-left: 5px solid #4caf50; margin-bottom: 2rem; border-radius: 6px; }
  </style>
</head>
<body>

  <h1>ğŸ” <code>auth_manager.py</code> ì„¤ëª…ì„œ</h1>
  <p>ì´ ëª¨ë“ˆì€ <strong>OAuth ì¸ì¦ ì²˜ë¦¬ ë° í† í° ê´€ë¦¬</strong>ë¥¼ ë‹´ë‹¹í•˜ëŠ” <code>AuthManager</code> í´ë˜ìŠ¤ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.<br>
     Google ì¸ì¦ì„ ê¸°ë³¸ìœ¼ë¡œ, í–¥í›„ Notion/Slack ë“±ìœ¼ë¡œ í™•ì¥ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆì–´ìš” âœ¨</p>

  <div class="block">
    <h2>ğŸ”— Redis ì—°ê²°</h2>
    <pre><code>redis_client = redis.Redis.from_url(REDIS_URL)</code></pre>
    <p><code>REDIS_URL</code>ì€ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©°, í† í° ì €ì¥/ë¡œë“œì— ì‚¬ìš©ë¼ìš”.</p>
  </div>

  <div class="block">
    <h2>ğŸ”§ <code>SCOPES</code> ì •ì˜</h2>
    <pre><code>SCOPES = {
  'google': ['https://www.googleapis.com/auth/calendar.readonly']
}</code></pre>
    <p>í”Œë«í¼ë³„ë¡œ í•„ìš”í•œ OAuth ê¶Œí•œ ë²”ìœ„ë¥¼ ì •ì˜í•œ ë”•ì…”ë„ˆë¦¬ì…ë‹ˆë‹¤.</p>
  </div>

  <div class="block">
    <h2>ğŸ§  í´ë˜ìŠ¤: <code>AuthManager</code></h2>
    <p>ì¸ì¦ í”Œë¡œìš°ë¥¼ ì‹œì‘í•˜ê³ , í† í°ì„ ì €ì¥/ë¡œë“œí•˜ê³ , ì‚¬ìš©ì ì •ë³´ë¥¼ ì¶”ì¶œí•˜ëŠ” ì±…ì„ì„ ì§‘ë‹ˆë‹¤.</p>

    <h3>ğŸ“Œ <code>__init__(platform)</code></h3>
    <p>í”Œë«í¼(google, notion ë“±)ì— ë”°ë¼ ì¸ì¦ ë²”ìœ„ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.</p>

    <h3>ğŸ“Œ <code>create_flow()</code></h3>
    <ul>
      <li>Google OAuth ì¸ì¦ URLì„ ìƒì„±í•˜ëŠ” <code>Flow</code> ê°ì²´ë¥¼ ë°˜í™˜</li>
      <li><code>client_id</code>, <code>client_secret</code>, <code>redirect_uri</code>ëŠ” í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë¡œë“œ</li>
    </ul>

    <h3>ğŸ“Œ <code>save_tokens(user_id, credentials)</code></h3>
    <p>ì‚¬ìš©ì í† í°ì„ Redisì— ì €ì¥í•©ë‹ˆë‹¤. <code>tokens:{platform}:{user_id}</code> í˜•ì‹ìœ¼ë¡œ ì €ì¥ë¼ìš”.</p>

    <h3>ğŸ“Œ <code>load_tokens(user_id)</code></h3>
    <p>Redisì—ì„œ í† í°ì„ ë¡œë“œí•˜ì—¬ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.</p>

    <h3>ğŸ“Œ <code>credentials_to_dict(credentials)</code></h3>
    <p><code>Credentials</code> ê°ì²´ë¥¼ JSON ì €ì¥ ê°€ëŠ¥í•œ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>

    <h3>ğŸ“Œ <code>get_user_id_from_credentials(credentials)</code></h3>
    <p>ì¸ì¦ëœ <code>id_token</code>ì—ì„œ ì‚¬ìš©ì ì´ë©”ì¼ì„ ì¶”ì¶œí•©ë‹ˆë‹¤.</p>
  </div>

  <div class="block">
    <h2>ğŸ“¦ Redis í‚¤ êµ¬ì¡°</h2>
    <ul>
      <li><strong>ì €ì¥ í˜•ì‹:</strong> <code>tokens:{platform}:{user_id}</code></li>
      <li><strong>ì˜ˆ:</strong> <code>tokens:google:me@example.com</code></li>
      <li><strong>ë‚´ìš©:</strong> JSON ì§ë ¬í™”ëœ access_token + refresh_token ë“±</li>
    </ul>
  </div>

  <div class="block">
    <h2>ğŸš§ í™•ì¥ í¬ì¸íŠ¸</h2>
    <ul>
      <li>í˜„ì¬ëŠ” Googleë§Œ êµ¬í˜„ë¨</li>
      <li>Notion/Slack ì¸ì¦ ì²˜ë¦¬ ì‹œ <code>create_flow()</code> ë‚´ ë¶„ê¸° í™•ì¥ ì˜ˆì •</li>
    </ul>
  </div>

</body>
</html>
