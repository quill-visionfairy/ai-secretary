<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>main.py ì „ì²´ ì½”ë“œ ì„¤ëª…</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; line-height: 1.6; padding: 2rem; background: #f9f9f9; }
    code { background-color: #eee; padding: 2px 6px; border-radius: 4px; }
    .block { background: #fff; border-left: 4px solid #0077cc; padding: 1rem; margin-bottom: 1rem; border-radius: 6px; }
    h2 { color: #005599; }
    ul { padding-left: 1.2rem; }
  </style>
</head>
<body>

  <h1>ğŸ“˜ <code>main.py</code> ì „ì²´ ì½”ë“œ ì„¤ëª…ì„œ</h1>
  <p>ì´ íŒŒì¼ì€ AI ë¹„ì„œ ì„œë¹„ìŠ¤ì—ì„œ Google Calendar APIì™€ì˜ í†µì‹ ì„ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ ëª¨ë“ˆì…ë‹ˆë‹¤.</p>

  <div class="block">
    <h2>ğŸ“Œ ì£¼ìš” ê¸°ëŠ¥ ìš”ì•½</h2>
    <ul>
      <li>ì‚¬ìš©ì ì¸ì¦ í† í° ê¸°ë°˜ìœ¼ë¡œ Google Calendar API ì ‘ê·¼</li>
      <li>ìº˜ë¦°ë” ì¼ì • ì¡°íšŒ ë° í¬ë§· ì²˜ë¦¬</li>
      <li>í”Œë«í¼ í™•ì¥(Notion, Slack ë“±)ì„ ê³ ë ¤í•œ êµ¬ì¡°</li>
    </ul>
  </div>

  <div class="block">
    <h2>ğŸ” <code>get_calendar_service(user_id, platform='google')</code></h2>
    <p><strong>ê°€ì¥ í•µì‹¬ì ì¸ ì¸ì¦ í•¨ìˆ˜</strong>ë¡œ, Redisì— ì €ì¥ëœ OAuth í† í°ì„ ê¸°ë°˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
    <ul>
      <li><code>AuthManager</code> ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•´ í”Œë«í¼ë³„ ì¸ì¦ ë„ìš°ë¯¸ ì‚¬ìš©</li>
      <li>Redisì—ì„œ í† í°ì„ ë¶ˆëŸ¬ì˜¤ê³ , ìœ íš¨ì„± ê²€ì‚¬ ë° ìë™ ê°±ì‹  ì²˜ë¦¬</li>
      <li>ìµœì¢…ì ìœ¼ë¡œ <code>build('calendar', 'v3')</code>ë¡œ Google Calendar API ê°ì²´ ìƒì„±</li>
    </ul>
    <pre><code>auth = AuthManager(platform)
tokens = auth.load_tokens(user_id)
if not tokens:
    print("[DEBUG] âŒ No tokens found for user_id")
    return None

creds = Credentials.from_authorized_user_info(tokens, auth.scopes)
if not creds or not creds.valid:
    if creds and creds.expired and creds.refresh_token:
        creds.refresh(Request())
        auth.save_tokens(user_id, creds)
    else:
        print("[DEBUG] âŒ Token expired and no refresh token")
        return None

return build('calendar', 'v3', credentials=creds)</code></pre>
  </div>

  <div class="block">
    <h2>ğŸ“„ <code>create_flow()</code></h2>
    <p>OAuth ì¸ì¦ì„ ìœ„í•œ Flow ê°ì²´ë¥¼ í”Œë«í¼ì— ë§ê²Œ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.</p>
  </div>

  <div class="block">
    <h2>ğŸ“„ <code>credentials_to_dict()</code></h2>
    <p>Googleì˜ Credentials ê°ì²´ë¥¼ JSON ì €ì¥ ê°€ëŠ¥í•œ ë”•ì…”ë„ˆë¦¬ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
  </div>

  <div class="block">
    <h2>ğŸ“„ <code>get_events()</code></h2>
    <p>ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ Google Calendarì—ì„œ ì¼ì •ì„ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.</p>
  </div>

  <div class="block">
    <h2>ğŸ“„ <code>format_event_time()</code></h2>
    <p>ìº˜ë¦°ë” ì´ë²¤íŠ¸ì˜ ì‹œì‘ ì‹œê°„ì„ ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ ë¬¸ìì—´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
  </div>

  <div class="block">
    <h2>ğŸ“„ <code>print_events_by_date()</code></h2>
    <p>ì½˜ì†” ë””ë²„ê¹…ìš©ìœ¼ë¡œ, ì´ë²¤íŠ¸ë“¤ì„ ë‚ ì§œë³„ë¡œ ì •ë¦¬í•˜ì—¬ ì¶œë ¥í•´ì¤ë‹ˆë‹¤.</p>
  </div>

  <div class="block">
    <h2>ğŸ“„ <code>check_google_calendar()</code></h2>
    <p>ì „ì²´ ì¡°íšŒ íë¦„ì„ ë‹´ë‹¹í•˜ëŠ” í•¨ìˆ˜ë¡œ, ì„œë¹„ìŠ¤ ê°ì²´ ìƒì„± â†’ ì¼ì • ì¡°íšŒ â†’ í¬ë§·ê¹Œì§€ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
  </div>

  <div class="block">
    <h2>ğŸ“„ <code>route_calendar_service()</code></h2>
    <p>í”Œë«í¼ì— ë”°ë¼ ì ì ˆí•œ ìº˜ë¦°ë” ì¡°íšŒ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ëŠ” ë¼ìš°íŒ… í•¨ìˆ˜ì…ë‹ˆë‹¤. í™•ì¥ì„± ê³ ë ¤ ìµœê³ !</p>
  </div>

  <div class="block">
    <h2>ğŸ“„ <code>main()</code></h2>
    <p>ì§ì ‘ ì‹¤í–‰ ì‹œ í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ì‘ë™í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤. ì–´ì œ~ë‚´ì¼ ë²”ìœ„ì˜ ì¼ì •ì„ ì¡°íšŒí•©ë‹ˆë‹¤.</p>
  </div>

</body>
</html>
